!function($,t,i){var e=$.className("transitioning"),s=$.className("pull-top-tips"),n=$.className("pull-bottom-tips"),l=$.className("pull-loading"),a=$.className("scroll"),o=$.className("pull-loading")+" "+$.className("icon")+" "+$.className("icon-pulldown"),r=o+" "+$.className("reverse"),p=$.className("pull-loading")+" "+$.className("spinner"),h=$.className("hidden"),u="."+l;$.PullToRefresh=$.Class.extend({init:function(t,i){this.element=t,this.options=$.extend(!0,{down:{height:75,callback:!1},up:{auto:!1,offset:100,show:!0,contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"没有更多数据了",callback:!1},preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/}},i),this.stopped=this.isNeedRefresh=this.isDragging=!1,this.state="beforeChangeOffset",this.isInScroll=this.element.classList.contains(a),this.initPullUpTips(),this.initEvent()},_preventDefaultException:function(t,i){for(var e in i)if(i[e].test(t[e]))return!0;return!1},initEvent:function(){$.isFunction(this.options.down.callback)&&(this.element.addEventListener("touchstart",this),this.element.addEventListener("drag",this),this.element.addEventListener("dragend",this)),this.pullUpTips&&(this.element.addEventListener("dragup",this),this.isInScroll?this.element.addEventListener("scrollbottom",this):t.addEventListener("scroll",this))},handleEvent:function(t){switch(t.type){case"touchstart":this.isInScroll&&this._canPullDown()&&t.target&&!this._preventDefaultException(t.target,this.options.preventDefaultException)&&t.preventDefault();break;case"drag":this._drag(t);break;case"dragend":this._dragend(t);break;case"webkitTransitionEnd":this._transitionEnd(t);break;case"dragup":case"scroll":this._dragup(t);break;case"scrollbottom":this.pullUpLoading(t)}},initPullDownTips:function(){var t=this;$.isFunction(t.options.down.callback)&&(t.pullDownTips=function(){var e=i.querySelector("."+s);return e&&e.parentNode.removeChild(e),e||(e=i.createElement("div"),e.classList.add(s),e.innerHTML='<div class="mui-pull-top-wrapper"><span class="mui-pull-loading mui-icon mui-icon-pulldown"></span></div>',e.addEventListener("webkitTransitionEnd",t)),t.pullDownTipsIcon=e.querySelector(u),i.body.appendChild(e),e}())},initPullUpTips:function(){var t=this;$.isFunction(t.options.up.callback)&&(t.pullUpTips=function(){var e=t.element.querySelector("."+n);return e||(e=i.createElement("div"),e.classList.add(n),t.options.up.show||e.classList.add(h),e.innerHTML='<div class="mui-pull-bottom-wrapper"><span class="mui-pull-loading">'+t.options.up.contentdown+"</span></div>",t.element.appendChild(e)),t.pullUpTipsIcon=e.querySelector(u),e}())},_transitionEnd:function(t){t.target===this.pullDownTips&&this.removing&&this.removePullDownTips()},_dragup:function(t){var i=this;if(!i.loading){if(t&&t.detail&&$.gestures.session.drag)i.isDraggingUp=!0;else if(!i.isDraggingUp)return;i.isDragging||i._canPullUp()&&i.pullUpLoading(t)}},_canPullUp:function(){if(this.removing)return!1;if(this.isInScroll){var e=this.element.parentNode.getAttribute("data-scroll");if(e){var s=$.data[e];return s.y===s.maxScrollY}}return t.pageYOffset+t.innerHeight+this.options.up.offset>=i.documentElement.scrollHeight},_canPullDown:function(){if(this.removing)return!1;if(this.isInScroll){var t=this.element.parentNode.getAttribute("data-scroll");if(t){return 0===$.data[t].y}}return 0===i.body.scrollTop},_drag:function(e){if(this.loading||this.stopped)return e.stopPropagation(),void e.detail.gesture.preventDefault();var n=e.detail;if(!this.isDragging&&"down"===n.direction&&this._canPullDown()){if(i.querySelector("."+s))return e.stopPropagation(),void e.detail.gesture.preventDefault();this.isDragging=!0,this.removing=!1,this.startDeltaY=n.deltaY,$.gestures.session.lockDirection=!0,$.gestures.session.startDirection=n.direction,this._pullStart(this.startDeltaY)}if(this.isDragging){e.stopPropagation(),e.detail.gesture.preventDefault();var l=n.deltaY-this.startDeltaY;l=Math.min(l,1.5*this.options.down.height),this.deltaY=l,this._pulling(l);var a=l>this.options.down.height?"afterChangeOffset":"beforeChangeOffset";if(this.state!==a&&(this.state=a,"afterChangeOffset"===this.state?(this.removing=!1,this.isNeedRefresh=!0):(this.removing=!0,this.isNeedRefresh=!1),this["_"+a](l)),$.os.ios&&parseFloat($.os.version)>=8){var o=n.gesture.touches[0].clientY;if(o+10>t.innerHeight||o<10)return void this._dragend(e)}}},_dragend:function(t){var i=this;i.isDragging&&(i.isDragging=!1,i._dragEndAfterChangeOffset(i.isNeedRefresh)),i.isPullingUp&&(i.pullingUpTimeout&&clearTimeout(i.pullingUpTimeout),i.pullingUpTimeout=setTimeout(function(){i.isPullingUp=!1},1e3))},_pullStart:function(t){this.pullStart(t),$.trigger(this.element,"pullstart",{api:this,startDeltaY:t})},_pulling:function(t){this.pulling(t),$.trigger(this.element,"pulling",{api:this,deltaY:t})},_beforeChangeOffset:function(t){this.beforeChangeOffset(t),$.trigger(this.element,"beforeChangeOffset",{api:this,deltaY:t})},_afterChangeOffset:function(t){this.afterChangeOffset(t),$.trigger(this.element,"afterChangeOffset",{api:this,deltaY:t})},_dragEndAfterChangeOffset:function(t){this.dragEndAfterChangeOffset(t),$.trigger(this.element,"dragEndAfterChangeOffset",{api:this,isNeedRefresh:t})},removePullDownTips:function(){if(this.pullDownTips)try{this.pullDownTips.parentNode&&this.pullDownTips.parentNode.removeChild(this.pullDownTips),this.pullDownTips=null,this.removing=!1}catch(t){}},pullStart:function(t){this.initPullDownTips(t)},pulling:function(t){this.pullDownTips.style.webkitTransform="translate3d(0,"+t+"px,0)"},beforeChangeOffset:function(t){this.pullDownTipsIcon.className=o},afterChangeOffset:function(t){this.pullDownTipsIcon.className=r},dragEndAfterChangeOffset:function(t){t?(this.pullDownTipsIcon.className=p,this.pullDownLoading()):(this.pullDownTipsIcon.className=o,this.endPullDownToRefresh())},pullDownLoading:function(){if(!this.loading){if(!this.pullDownTips)return this.initPullDownTips(),void this.dragEndAfterChangeOffset(!0);this.loading=!0,this.pullDownTips.classList.add(e),this.pullDownTips.style.webkitTransform="translate3d(0,"+this.options.down.height+"px,0)",this.options.down.callback.apply(this)}},pullUpLoading:function(t){this.loading||this.finished||(this.loading=!0,this.isDraggingUp=!1,this.pullUpTips.classList.remove(h),t&&t.detail&&t.detail.gesture&&t.detail.gesture.preventDefault(),this.pullUpTipsIcon.innerHTML=this.options.up.contentrefresh,this.options.up.callback.apply(this))},endPullDownToRefresh:function(){this.loading=!1,this.pullUpTips&&this.pullUpTips.classList.remove(h),this.pullDownTips.classList.add(e),this.pullDownTips.style.webkitTransform="translate3d(0,0,0)",this.deltaY<=0?this.removePullDownTips():this.removing=!0},endPullUpToRefresh:function(i){i?(this.finished=!0,this.pullUpTipsIcon.innerHTML=this.options.up.contentnomore,this.element.removeEventListener("dragup",this),t.removeEventListener("scroll",this)):this.pullUpTipsIcon.innerHTML=this.options.up.contentdown,this.loading=!1},setStopped:function(t){t!=this.stopped&&(this.stopped=t,this.pullUpTips&&this.pullUpTips.classList[t?"add":"remove"](h))},refresh:function(i){i&&this.finished&&this.pullUpTipsIcon&&(this.pullUpTipsIcon.innerHTML=this.options.up.contentdown,this.element.addEventListener("dragup",this),t.addEventListener("scroll",this),this.finished=!1)}}),$.fn.pullToRefresh=function(t){var i=[];return t=t||{},this.each(function(){var e=this,s=null,n=e.getAttribute("data-pullToRefresh");n?s=$.data[n]:(n=++$.uuid,$.data[n]=s=new $.PullToRefresh(e,t),e.setAttribute("data-pullToRefresh",n)),t.up&&t.up.auto&&s.pullUpLoading(),i.push(s)}),1===i.length?i[0]:i}}(mui,window,document);