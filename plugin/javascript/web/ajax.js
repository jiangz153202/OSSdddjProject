mui.back=function(){var e=window.localStorage.getItem("isUnLogin");if(null!=e&&"1"==e)window.localStorage.removeItem("isUnLogin"),window.history.go(-3);else{if("function"==typeof mui.options.beforeback&&mui.options.beforeback()===!1)return;mui.doAction("backs")}},function(e,t,o){"use strict";t.alertOptions={msg:"",onShow:function(e){e.mask=mui.createMask(),e.mask.show()},onHidden:function(e){e.mask.close()},callback:null};var n=function(){};n.base64Encode=function(e){var o;return o=encodeURIComponent(e),o=unescape(o),o=t.btoa(o)},n.base64Decode=function(e){var o;return o=t.atob(e),o=escape(o),o=decodeURIComponent(o)},n.setLoginUser=function(e){t.localStorage.setItem("dddjUserItem",JSON.stringify(e.data)),console.log("存入成功"+JSON.stringify(e.data))},n.getLoginUser=function(){return JSON.parse(t.localStorage.getItem("dddjUserItem"))},n.returnDeviceType=function(){var e="";return mui.os.ios?e="10":mui.os.android&&(e="1"),e},n.getRequestJsonP=function(e){var t={urlPath:"",data:{},onSuccess:null,onError:null};mui.extend(!0,t,e),mui.getJSONP(t.urlPath,t.data,function(e){"function"==typeof t.onSuccess&&t.onSuccess(e)})},n.getAjaxRequestJson=function(e){var t={urlPath:"",data:{},dataType:"json",type:"post",timeout:1e4,headers:{Accept:"*"},onBeforeSend:null,onComplete:null,onSuccess:null,onError:null,isHeader:!0};mui.extend(!0,t,e);var i=JSON.parse(localStorage.getItem("accessGrant"));null!=i&&i!=o&&t.isHeader&&(t.headers.Authorization=i.token_type+" "+i.access_token),mui.ajax(t.urlPath,{data:t.data,dataType:t.dataType,type:t.type,timeout:t.timeout,headers:t.headers,xhrFields:{withCredentials:!0},beforeSend:function(e){"function"==typeof t.onBeforeSend&&t.onBeforeSend()},complete:function(e){"function"==typeof t.onComplete&&t.onComplete()},success:function(e){"function"==typeof t.onSuccess&&t.onSuccess(e)},error:function(e,a,r){if(401==e.status){var c=JSON.parse(e.responseText);if(c.error!=o)if("invalid_token"==c.error&&c.error_description.startWidth("Access token expired"))n.refreshToken({grant_type:i.refresh_token,onSuccess:function(){n.getAjaxRequestJson(t)}}),console.log("这里是无效的token， 可以尝试用refresh_token刷新access_token");else if("unauthorized"==c.error||c.error_description.startWidth("Invalid refresh token"))return console.log("这里就是要去登录获取access_token"),void n.switchTarget.unLogined()}}})},n.switchTarget={unLogined:function(){mui!==o&&mui.os.wechat!=o?setTimeout(function(){t.location.href=common.config.rootPath+"/user/logins.html?callback="+t.encodeURIComponent(t.location.href)+"&wxlogin=1"},300):setTimeout(function(){t.location.href=common.config.rootPath+"/user/logins.html?callback="+t.encodeURIComponent(t.location.href)},300)}},n.lazyloadTmpl=function(e){e.removeAttribute("data-imagelazyload"),mui(e).imageLazyload()},n.unicode=function(e){for(var t="",o=0,n=e.length;o<n;++o)t+=String.fromCharCode(e[o]);return t},n.pageInit=function(){"html5plus"!=navigator.userAgent.toLowerCase().match(/html5plus/)&&(mui.openWindow=function(e,o,n){"_blank"==e.target?t.open(e.url):setTimeout(function(){t.location.href=e.url},300)});var e=".mui-content";arguments[0]!=o&&(e=arguments[0]),mui(e).on("tap","a",function(e){this.classList.contains("mui-disabled")?(mui.preventDefault(e),mui.stopPropagation(e)):mui.openWindow({url:this.getAttribute("href"),id:"info"})})},n.ajaxJavascript=function(e){var o=e.match(/<script (.|\n)*?>(.|\n|\r\n)*?<\/script>/gi);if(o)for(var n=o.length,i=0;i<n;i++){var a=o[i].match(/<script(.|\n)*?>((.|\n|\r\n)*)?<\/script>/im);a[2]&&(t.execScript?t.execScript(a[2]):t.eval(a[2]))}},n.uploadFile=function(e,t){var o=new FormData;if(e){var n=e.name;o.append("fileName",n),o.append("file",e)}var i=new XMLHttpRequest;i.addEventListener("error",function(e){"function"==typeof t&&t({msg:"上传失败，请重试！",status:1})},!1),i.withCredentials=!0,i.onreadystatechange=function(){4===i.readyState&&200===i.status&&"function"==typeof t&&t(JSON.parse(i.responseText))},i.open("POST",common.config.appPath+"/api/user/upload",!0),i.setRequestHeader("Accept","*");try{i.send(o)}catch(e){}},n.cookieItem={setCookie:function(e,o,n){t.localStorage.setItem(e,o)},getCookie:function(e,o){var i=t.localStorage.getItem(e);if(!("dddjsid"==e&&null==i||"dddjsid"==e&&"object"==typeof i))return"function"==typeof o&&o(i),i;t.localStorage.removeItem(e),n.cookieItem.getExpress(function(){var t=n.cookieItem.getCookie(e);"function"==typeof o&&o(t)})},removeCookie:function(e){n.cookieItem.setCookie(e,1,-1)},getExpress:function(e){var t=document.getElementsByTagName("head"),o=document.createElement("script");o.src=common.config.sinaCityUrl,o.type="text/javascript",t[0].appendChild(o),o.onload=o.onreadystatechange=function(){if(!this.readyState||"loaded"==this.readyState||"complete"==this.readyState){var t=remote_ip_info.city;if(""==t)return alert("定位失败");var i=t.indexOf("市")==-1?t+"市":t,a={urlPath:common.config.currentShopIdUrl,data:{city:i},onSuccess:function(t){t?(n.cookieItem.setCookie("dddjsid",t,1),n.cookieItem.setCookie("dddjsname",i,1),"function"==typeof e&&e()):(n.cookieItem.setCookie("dddjsid",1,1),n.cookieItem.setCookie("dddjsname","东莞市",1),"function"==typeof e&&e())}};n.getAjaxRequestJson(a)}o.onload=o.onreadystatechange=null}}},n.isLogined=function(e,t){var o=common.config.appPath+"/api/user/isLogined",i={urlPath:o,onSuccess:function(o){0==o.status&&1==o.data?"function"==typeof e&&e():"function"==typeof t&&t()},onError:function(e){console.log("失败回调")}};n.getAjaxRequestJson(i)},n.refreshToken=function(e){var t=common.config.appPath+"/oauth/token";mui.ajax(t,{data:{grant_type:"refresh_token",refresh_token:e.grant_type},dataType:"json",type:"post",xhrFields:{withCredentials:!0},success:function(t){localStorage.setItem("accessGrant",JSON.stringify(t)),"function"==typeof e.onSuccess&&e.onSuccess()},error:function(e,t,o){console.log("重新刷新无效"),n.switchTarget.unLogined()}})},t.AjaxCommon=n}(document,window,void 0);