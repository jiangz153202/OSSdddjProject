+function(e,t){var n={init:function(e){e=this.setOptions(e||{}),this.initPage(e)},setOptions:function(e){return e.this=this,e.getGoodsListUrl=common.config.appPath+"/api/goods/list",e.locationStoresUrl=common.config.appPath+"/api/locationStores",e.getArticleUrl=common.config.appPath+"/api/article/list",e.tmplHtmlModelEmpty=t.getElementById("tmpl-model-null"),e},initPage:function(e){var n=template("tmpl-menus",e.navResult);common.insertHTML(t.body,"afterbegin",n),e.this.initcomponents(e)},initcomponents:function(t){var n=e.os.ios?.003:9e-4;e(".mui-scroll-wrapper").scroll({bounce:!1,indicators:!1,deceleration:n}),e(".mui-slider").slider(),e.each(t.this.getScrollContainers(),function(n,i){e(i).pullToRefresh({up:{callback:function(){var e=this;t.this.pullUpLoadGoodsGroup(t,e)}}})}),e.os.plus?e.plusReady(function(){setTimeout(function(){t.this.pullUpLoading(t)},1e3)}):e.ready(function(){t.this.pullUpLoading(t)}),document.querySelector(".mui-slider.mui-postion-qc-bar").addEventListener("slide",function(e){setTimeout(function(){t.this.pullUpLoading(t)},500)})},pullUpLoading:function(t){var n=t.this.getActiveProductContainer(),i=t.this.getScrollContainers(),o=n.querySelector(".list-container");if(""===o.innerHTML.trim()){e(i[o.dataset.index]).pullToRefresh().pullUpLoading()}},getActiveProductContainer:function(){return t.querySelector(".mui-control-content.mui-active")},getScrollContainers:function(){return e(document.querySelectorAll(".mui-slider-group .mui-scroll"))},pullUpLoadGoodsGroup:function(e,t){var n=e.this.getActiveProductContainer();if(null==n)return common.alert({msg:"获取当前模块出错"}),!1;switch(n.querySelector(".list-container").dataset.id){case"1":e.this._pullListGoods(e,t);break;case"2":e.this._pullListStore(e,t);break;case"3":e.this._pullListArticle(e,t);break;default:null==n.querySelector(".spinner-child")||n.querySelector(".spinner-child").classList.contains("mui-hide")||n.querySelector(".spinner-child").classList.add("mui-hide"),t.endPullUpToRefresh(!0)}},pullUpToRefreshScrollToTop:function(t){e(t.this.getActiveProductContainer().querySelector(".mui-scroll-wrapper")).pullRefresh().scrollTo(0,0,1500)},_pullListGoods:function(e,t){var n=e.this.getActiveProductContainer();if(null==n)return common.alert({msg:"获取当前模块出错"}),!1;var i=n.querySelector(".list-container"),o=i.getAttribute("data-pageIndex");o=parseInt(o)+1,i.setAttribute("data-pageIndex",o);var l={urlPath:e.getGoodsListUrl,data:{pageIndex:o,sid:AjaxCommon.cookieItem.getCookie("dddjsid")},onBeforeSend:function(){},onSuccess:function(o){if(0==o.status){if(o.data.content.length>0){var l=template("tmpl-goods",o.data);i.innerHTML+=l,i.classList.remove("mui-hide"),AjaxCommon.lazyloadTmpl(i)}else""==i.innerHTML.trim()&&(i.parentNode.innerHTML+=e.tmplHtmlModelEmpty.innerHTML,i.classList.add("mui-hide"));if(o.data.hasNextPage)t.endPullUpToRefresh(!1);else{t.endPullUpToRefresh(!0);var r=n.querySelector(".mui-pull-bottom-tips");null==r||r.classList.contains("mui-hide")||r.classList.add("mui-hide")}null==n.querySelector(".spinner-child")||n.querySelector(".spinner-child").classList.contains("mui-hide")||n.querySelector(".spinner-child").classList.add("mui-hide")}else common.alert({msg:o.msg||"读取出错"})},onError:function(){console.log("失败回调"),""==i.innerHTML.trim()&&(i.innerHTML=e.tmplHtmlModelEmpty.innerHTML),t.endPullUpToRefresh(!0)}};AjaxCommon.getAjaxRequestJson(l)},_pullListStore:function(e,n){var i=e.this.getActiveProductContainer();if(null==i)return common.alert({msg:"获取当前模块出错"}),!1;var o=i.querySelector(".list-container"),l=o.getAttribute("data-pageIndex");l=parseInt(l)+1,o.setAttribute("data-pageIndex",l);var r={urlPath:e.locationStoresUrl,data:{distance:600,sid:1,longitude:113.893905,latitude:22.950063},onBeforeSend:function(){},onSuccess:function(e){if(0==e.status&&null!=e.data&&e.data.content.length>0){var l=template("tmpl-store",e.data);o.innerHTML=l,AjaxCommon.lazyloadTmpl(o)}else o.parentNode.innerHTML+=t.getElementById("tmpl-model-null").innerHTML,o.classList.add("mui-hide");if(e.data.hasNextPage)n.endPullUpToRefresh(!1);else{n.endPullUpToRefresh(!0);var r=i.querySelector(".mui-pull-bottom-tips");null==r||r.classList.contains("mui-hide")||r.classList.add("mui-hide")}},onComplete:function(){null==i.querySelector(".spinner-child")||i.querySelector(".spinner-child").classList.contains("mui-hide")||i.querySelector(".spinner-child").classList.add("mui-hide")},onError:function(){console.log("失败回调"),n.endPullUpToRefresh(!0)}};AjaxCommon.getAjaxRequestJson(r)},_pullListArticle:function(e,t){var n=e.this.getActiveProductContainer();if(null==n)return common.alert({msg:"获取当前模块出错"}),!1;var i=n.querySelector(".list-container"),o=i.getAttribute("data-pageIndex");o=parseInt(o)+1,i.setAttribute("data-pageIndex",o);var l={urlPath:e.getArticleUrl,data:{pageIndex:o,sid:AjaxCommon.cookieItem.getCookie("dddjsid")},onBeforeSend:function(){},onSuccess:function(e){if(0==e.status&&null!=e.data&&e.data.content.length>0){var o=template("tmpl-article",e.data);i.innerHTML+=o,AjaxCommon.pageInit(i),t.endPullUpToRefresh(!e.data.hasNextPage)}else t.endPullupToRefresh(!0),""==i.innerHTML.trim()&&(i.innerHTML=document.getElementById("tmpl-model-null").innerHTML);null==n.querySelector(".spinner-child")||n.querySelector(".spinner-child").classList.contains("mui-hide")||n.querySelector(".spinner-child").classList.add("mui-hide")},onError:function(){console.log("失败回调"),t.endPullupToRefresh(!0),""==i.innerHTML.trim()&&(i.innerHTML=document.getElementById("tmpl-model-null").innerHTML)}};AjaxCommon.getAjaxRequestJson(l)}};window.Collection=n}(mui,document);