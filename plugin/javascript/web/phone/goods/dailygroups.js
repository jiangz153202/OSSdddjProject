+function(t,e,o){"use strict";var n={init:function(o){o=this.setOptions(o||{}),t.init(),AjaxCommon.cookieItem.getCookie("dddjsid",function(t){o.sid=t,o.this.initGetTagsUrl(o)}),null!=e.querySelector(".d-head-search input")&&e.querySelector(".d-head-search input").addEventListener("tap",function(){setTimeout(function(){window.location.href=common.config.rootPath+"/goods/search"},100)})},setOptions:function(t){return t.this=this,t.scale=.56,t.gettagsUrl=common.config.appPath+"/api/goods/listGroups",t.getgroupgoodsUrl=common.config.appPath+"/api/goods/getGroupGoods",t.getGoodsListUrl=common.config.appPath+"/api/goods/list",t.addCartUrl=common.config.appPath+"/api/cart/add",t.bodyContainer=e.getElementById("body-container"),t.tmplHtmlModelEmpty=e.getElementById("tmpl-model-null"),t},initGetTagsUrl:function(o){var n={urlPath:o.gettagsUrl,data:{sid:o.sid,isHeader:!1},onBeforeSend:function(){o.bodyContainer.innerHTML=e.getElementById("tmpl-model-loading").innerHTML},onSuccess:function(e){if(0==e.status)if("function"==typeof template)if(0==e.status&&e.data.length>0){o.bodyContainer.innerHTML="";var n=template("tmpl-groups",e);o.bodyContainer.innerHTML+=n,t(o.bodyContainer).imageLazyload(),t(".mui-scroll-wrapper").scroll({deceleration:5e-4}),o.controls=document.getElementById("segmentedControls"),o.contents=document.getElementById("segmentedControlContents"),o.this.initLeftListEvents(o),null==o.this.getActiveProductContainer()&&(o.controls.querySelector(".mui-control-item").classList.add("mui-active"),o.contents.querySelector(".mui-control-content").classList.add("mui-active")),o.this.DomTabSelected(o),t.each(o.this.getScrollContainers(),function(e,n){t(n).pullToRefresh({up:{callback:function(){var t=this;console.log("激活"),o.this.pullUpLoadGoodsGroup(o,t)}}})}),t.os.plus?t.plusReady(function(){setTimeout(function(){o.this.pullUpLoading(o)},1e3)}):t.ready(function(){o.this.pullUpLoading(o)})}else common.alert({msg:"系统分类获取失败"});else common.alert({msg:"模板js文件未引用"});else common.alert({msg:e.message})},onError:function(){console.log("失败回调")}};AjaxCommon.getAjaxRequestJson(n)},initLeftListEvents:function(e){for(var o=e.controls.querySelectorAll(".mui-control-item"),n=0;n<o.length;n++){o[n].addEventListener("tap",function(){setTimeout(function(){e.this.pullUpLoading(e)},500)})}t(".dddj-menu").on("tap",".menu-backtop",function(){e.this.pullUpToRefreshScrollToTop(e)})},DomTabSelected:function(t){for(var o=e.querySelectorAll(".menuType"),n=0;n<o.length;n++)for(var i=o[n],a=i.querySelectorAll("li"),r=0;r<a.length;r++){var s=a[r];s.addEventListener("tap",function(){var e=this,o=e.dataset.name;switch(console.log(o),o){case"sold":var n=t.this.getActiveProductContainer().querySelector('li[data-name="price"]');n.classList.remove("mui-active-top"),n.classList.remove("mui-active-bottom"),1==e.classList.contains("mui-active")?e.classList.remove("mui-active"):e.classList.add("mui-active");break;case"price":var n=t.this.getActiveProductContainer().querySelector('.menuType li[data-name="sold"]');n.classList.remove("mui-active"),e.classList.contains("mui-active-top")?(e.classList.remove("mui-active-top"),e.classList.add("mui-active-bottom")):e.classList.contains("mui-active-bottom")?(e.classList.remove("mui-active-top"),e.classList.remove("mui-active-bottom")):(e.classList.add("mui-active-top"),e.classList.remove("mui-active-bottom"))}t.this.pullUpToRefresh(t)})}},pullUpLoading:function(e){var o=e.this.getActiveProductContainer(),n=e.this.getScrollContainers();if(""===o.querySelector(".list-container").innerHTML.trim()){t(n[o.dataset.contentindex]).pullToRefresh().pullUpLoading()}},pullUpToRefresh:function(e){var o=e.this.getActiveProductContainer(),n=e.this.getScrollContainers();if(o.setAttribute("data-pageIndex",0),o.querySelector(".product-list-container .list-layout-demo.list-container").innerHTML="",""===o.querySelector(".list-container").innerHTML.trim()){var i=o.dataset.contentindex;t(n[i]).pullToRefresh().refresh(!0),t(n[i]).pullToRefresh().pullUpLoading()}},getActiveProductContainer:function(){return e.querySelector(".mui-control-content.mui-active")},getScrollContainers:function(){return t(".mui-scroll")},getDefaultSelected:function(t){for(var e="",o=t.querySelectorAll(".menuType li"),n=0;n<o.length;n++)o[n].classList.contains("mui-active")?e="sold desc":o[n].classList.contains("mui-active-top")?e="price desc":o[n].classList.contains("mui-active-bottom")&&(e="price asc");return e},pullUpLoadGoodsGroup:function(e,o){var n=e.this.getActiveProductContainer();if(null==n)return common.alert({msg:"获取当前模块出错"}),!1;var i=n.getAttribute("data-pageIndex");i=parseInt(i)+1,n.setAttribute("data-pageIndex",i);var a=e.this.getDefaultSelected(n),r={sid:e.sid,pageIndex:i,gid:n.dataset.id,sorts:a,distrbution:""},s=n.querySelector(".product-list-container .list-layout-demo.list-container"),l={urlPath:e.getGoodsListUrl,data:r,onBeforeSend:function(){},onSuccess:function(n){if(0==n.status)if("function"==typeof template)if(0==n.status&&null!=n.data){var i=template("tmpl-model",n.data);s.innerHTML+=i,e.bodyContainer.removeAttribute("data-imagelazyload"),t(e.bodyContainer).imageLazyload(),o.endPullUpToRefresh(!n.data.hasNextPage)}else""==s.innerHTML.trim()&&(s.innerHTML=e.tmplHtmlModelEmpty.innerHTML),o.endPullUpToRefresh(!0);else common.alert({msg:"模板js文件未引用"});else common.alert({msg:n.msg||"查询出错"})},onError:function(){console.log("失败回调")}};AjaxCommon.getAjaxRequestJson(l)},pullUpToRefreshScrollToTop:function(e){t(e.this.getActiveProductContainer().querySelector(".mui-scroll-wrapper")).pullRefresh().scrollTo(0,0,1500)},initParabola:function(t){var e=document.querySelector("#flyItem"),o=document.querySelector("#shopCart"),n=parseInt(o.querySelector(".mui-badge").innerHTML.trim()),i=funParabola(e,o,{speed:800,curvature:.02,complete:function(){e.style.visibility="hidden",o.querySelector(".mui-badge").innerHTML=++n,n>0?o.querySelector(".mui-badge").classList.remove("mui-hide"):o.querySelector(".mui-badge").classList.add("mui-hide")}});e&&o&&[].slice.call(document.getElementsByClassName("mui-add-cart")).forEach(function(o){o.addEventListener("tap",function(o){var n=this,a=n.getBoundingClientRect();e.style.left=a.left+"px",e.style.top=a.top+"px",e.style.visibility="visible";var r=n.id+"--1";t.this.addCart(t,r),i.position().move()})})},setVideoGroup:function(t){var o=window.screen.width||e.body.clientWidth;o=o>640?640:o;var n=Math.ceil(o*t.scale);document.body.querySelector(".z-imgContnet").style.height=n+"px"},removeLoading:function(t){document.body.removeChild(t.loading)},htmlReplace:function(t,e,o,n){return t=n?t.replace(new RegExp(e,"gm"),o):t.replace(e,o)},addCart:function(t,e){var o={urlPath:t.addCartUrl,data:{sid:t.sid,itemStr:e},onBeforeSend:function(){},onSuccess:function(t){},onError:function(){console.log("失败回调")}};AjaxCommon.getAjaxRequestJson(o)}};window.dailygroups=n}(mui,document);