+function(e,t){var n={init:function(t){t=this.setOptions(t||{});var n=e.os.ios?.003:9e-4;e(".mui-scroll-wrapper:not(.mui-not-scroll)").scroll({bounce:!1,indicators:!1,deceleration:n}),this._initPage(t)},setOptions:function(n){return n.this=this,n.pullrefresh=e("#pullrefresh"),n.listContainer=t.getElementById("list-container"),n.menuContainer=t.getElementById("menu-container"),n.catsContainer=t.getElementById("cats-container"),n.brandsContainer=t.getElementById("brands-container"),n.catsListUrl=common.config.carAppPath+"/capi/goods/cat/target/relation/cats.json",n.brandListUrl=common.config.carAppPath+"/capi/goods/cat/target/relation/brands.json",n.getRelationByBrandUrl=common.config.carAppPath+"/capi/goods/cat/target/relation/goods.json",n.targetGlobalId=void 0==common.queryToJSON().targetGlobalId?"2":common.queryToJSON().targetGlobalId,n.busying=!1,n},_initPage:function(n){e.init({pullRefresh:{container:"#pullrefresh",up:{contentrefresh:"正在加载...",contentnomore:"没有更多数据",callback:function(){n.this.pullupRefresh(n)}}}}),document.body.setAttribute("data-pageIndex",0),t.body.dataset.isscrolltotop=0,e.os.plus?e.plusReady(function(){setTimeout(function(){n.pullrefresh.pullRefresh().pullupLoading()},1e3)}):e.ready(function(){n.pullrefresh.pullRefresh().pullupLoading()}),n.this._initScreen(n)},_initScreen:function(t){e(".mui-screen-title").on("tap",".mui-screen-title-item",function(n){var i=this;e(".mui-screen-title-item").each(function(){i.dataset.index!=this.dataset.index&&this.classList.remove("mui-active")}),this.classList.toggle("mui-active"),this.classList.contains("mui-active")&&(0==i.dataset.index?(t.catsContainer.classList.remove("mui-hidden"),t.brandsContainer.classList.add("mui-hidden")):(t.catsContainer.classList.add("mui-hidden"),t.brandsContainer.classList.remove("mui-hidden")),void 0==this.dataset.isloading?(console.log("没有加载过"),t.this.findData(t,i.dataset.index)):(t.this.toggleMenu(t),t.this.totalThisHeight(t,i.dataset.index)))});var n=document.getElementById("menu-wrapper");document.getElementById("menu"),n.classList;document.getElementById("menu-backdrop").addEventListener("tap",function(){t.this.toggleMenu(t),e(".mui-screen-title-item").each(function(){this.classList.remove("mui-active")})})},pullupRefresh:function(n){var i=document.body.getAttribute("data-pageIndex");i=parseInt(i)+1,document.body.setAttribute("data-pageIndex",i);for(var a=n.getRelationByBrandUrl,l={page:i,limit:20,targetGlobalId:n.targetGlobalId,sortType:0},s=t.querySelectorAll(".mui-screen-title-item"),o=0;o<s.length;o++){var r=s[o];if(r.children.length>0)if(0==r.dataset.index){var u=n.catsContainer.querySelector("li.mui-selected");null!=u&&0!=u.dataset.goodscatid&&(l.goodsCatId=u.dataset.goodscatid)}else if(1==r.dataset.index){var u=n.brandsContainer.querySelector("li.mui-selected");null!=u&&0!=u.dataset.brandid&&(l.brandId=u.dataset.brandid)}}console.log(JSON.stringify(l));var d={urlPath:a,data:l,onSuccess:function(i){if(1==i.head.bcode){var a=template("tmpl-model",i.data);n.listContainer.innerHTML+=a,0==i.data.items.length&&""==n.listContainer.innerHTML.trim()&&(n.listContainer.innerHTML=t.getElementById("tmpl-model-null").innerHTML),i.data.hasNextPage?n.pullrefresh.pullRefresh().endPullupToRefresh(!1):(n.pullrefresh.pullRefresh().disablePullupToRefresh(),n.pullrefresh.pullRefresh().endPullupToRefresh(!0)),e(n.listContainer).off("tap",".mui-media"),e(n.listContainer).on("tap",".mui-media",function(){var e=this.dataset.targettype,t=this.dataset.catid;switch(e){case"1":console.log("商品");var n=common.config.rootPath+"/phone/goods/view.html?catId="+t;setTimeout(function(){window.location.href=n},300)}})}else n.pullrefresh.pullRefresh().disablePullupToRefresh(),n.pullrefresh.pullRefresh().endPullupToRefresh(!0),n.listContainer.innerHTML=t.getElementById("tmpl-model-null").innerHTML},onError:function(){console.log("失败回调")}};AjaxCommon.getAjaxRequestJson(d)},pullClearAndReload:function(e){t.body.dataset.isscrolltotop=1;setTimeout(function(){document.getElementsByClassName("mui-model-null").length>0&&document.getElementsByClassName("mui-model-null")[0].parentNode.removeChild(document.getElementsByClassName("mui-model-null")[0]),e.pullrefresh.scroll().scrollTo(0,0),document.body.setAttribute("data-pageIndex",0),e.pullrefresh.pullRefresh().finished&&e.pullrefresh.pullRefresh().refresh(!0),e.listContainer.innerHTML="",e.pullrefresh.pullRefresh().pullupLoading()},500)},toggleMenu:function(e){var t=document.getElementById("menu-wrapper"),n=document.getElementById("menu"),i=t.classList,a=document.getElementById("menu-backdrop");if(e.busying)return void console.log("完蛋了");e.busying=!0,i.contains("mui-active")?(document.body.classList.remove("menu-open"),t.className="menu-wrapper fade-out-up animated",n.className="menu bounce-out-up animated",setTimeout(function(){a.style.opacity=0,a.classList.add("mui-hidden"),t.classList.add("hidden")},500)):(document.body.classList.add("menu-open"),t.className="menu-wrapper fade-in-down animated mui-active",n.className="menu bounce-in-down animated",a.style.opacity=1,a.classList.remove("mui-hidden")),setTimeout(function(){e.busying=!1},500)},findData:function(t,n){var i=n,a={targetGlobalId:t.targetGlobalId},l="",s="",o=null;switch(n){case"0":l=t.catsListUrl,o=t.catsContainer,s="tmpl-cats";break;case"1":l=t.brandListUrl,o=t.brandsContainer,s="tmpl-brand"}alertOptions.msg="正在请求中...",alertOptions.callback=function(r){var u={urlPath:l,data:a,onSuccess:function(a){if(1==a.head.bcode){var l=template(s,a.data);o.innerHTML=l,t.this.totalThisHeight(t,n),t.this.toggleMenu(t),e(".mui-screen-title-item").each(function(){this.dataset.index==n&&(this.dataset.isloading=1)}),e(".menu").off("tap",".mui-table-view-cell"),e(".menu").on("tap",".mui-table-view-cell",function(){t.this.toggleMenu(t),e(".mui-screen-title-item").each(function(){this.classList.remove("mui-active")}),e(".mui-screen-title-item")[i].querySelector(".title").innerHTML=this.innerText.trim(),setTimeout(function(){t.this.pullClearAndReload(t)},300)}),r.setMsg("请求成功"),r.hide()}else r.setMsg("请求失败"),r.hide()},onError:function(){console.log("失败回调")}};AjaxCommon.getAjaxRequestJson(u)},common.alert(alertOptions)},totalThisHeight:function(t,n){var i=null;e(".mui-screen-title-item").each(function(){this.dataset.index==n&&(i=this)});var a=document.getElementById("menu").querySelector(".menu-scroll-wrapper"),l=window.screen.height-85,s=a.querySelectorAll(".mui-table-view"),o=s[n];console.log(o.clientHeight>l?l:o.clientHeight),a.style.height=(o.clientHeight>l?l:o.clientHeight)+"px";var r=e.os.ios?.003:9e-4;e(".mui-scroll-wrapper:not(.mui-not-scroll)").scroll({bounce:!1,indicators:!1,deceleration:r})}};window.brands=n}(mui,document);