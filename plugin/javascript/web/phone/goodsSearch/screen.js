+function(t,e){var o={init:function(e){e=this.setOptions(e||{});var o={urlPath:e.brandListUrl,data:{targetId:e.targetId,targetType:e.targetType},onSuccess:function(o){if(1==o.head.bcode){var i=template("tmpl-brands",o);e.brandsContainer.innerHTML=i;var n=t.os.ios?.003:9e-4;t(".mui-scroll-wrapper").scroll({bounce:!1,indicators:!1,deceleration:n}),e.this._initScreen(e),e.this._initPage(e)}else common.alert({msg:JSON.stringify(o.head)||"读取出错"})},onError:function(){console.log("失败回调")}};AjaxCommon.getAjaxRequestJson(o)},setOptions:function(o){return o.this=this,o.UpdateNewCache=!0,o.navContainer=e.querySelector(".mui-screen"),o.pullrefresh=t("#pullrefresh"),o.listContainer=e.getElementById("list-container"),o.brandsContainer=e.getElementById("brands-container"),o.brandListUrl=common.config.carAppPath+"/capi/brand/listByTargetTypeAndId.json",o.getGoodsByBrandUrl=common.config.carAppPath+"/capi/brand/goods.json",o.targetType=void 0==common.queryToJSON().targetType?"":common.queryToJSON().targetType,o.targetId=void 0==common.queryToJSON().targetId?"":common.queryToJSON().targetId,o.getGoodsCatsListUrl=common.config.carAppPath+"/capi/goods/cat/list/goods/"+o.targetId+".json",o.getGoodsDetailUrl=common.config.carAppPath+"/capi/goods/detail/",o.addCartUrl=common.config.carAppPath+"/capi/shoppingCart/add.json",o.subOrderUrl=common.config.rootPath+"/phone/order/orderConfirm.html",o.defaultCartPopover="popover-cart",o},_initParem:function(t){for(var e=0;e<t.navs.data.length;e++){var o=t.navs.data[e],i="";switch(o.type){case"group":i=t.getGoodsGroupUrl;break;case"tag":i=t.getGoodsTagUrl}""!=i&&t.this.pushData(o,i,t)}},_initResetMenus:function(t){if("function"==typeof template){var e=template("tmpl-menus",t.navs);t.navContainer.innerHTML=e,t.this._initScreen(t)}else common.alert({msg:"模板文件未加载！"})},pushData:function(e,o,i){var n=null;for(var a in i.navs.data)i.navs.data[a].type==e.type&&(n=i.navs.data[a]);t.post(o,{},function(t){if(0==t.status){for(var o=0;o<t.data.length;o++){var a=t.data[o];n.menus.push({cdt:a.id,name:a.name}),n.status=1}window.localStorage.setItem("mui-menu-items",JSON.stringify(i.navs)),i.this._initResetMenus(i)}else for(var s in i.navs.data)i.navs.data[s].type==e.type&&i.navs.data.splice(s,1)},"json")},_selfCheckBugs:function(t,e){for(var o=0;o<t.navs.data.length;o++){0==t.navs.data[o].status&&console.log("自检错误")}"function"==typeof e&&e()},_initPage:function(o){t.init({pullRefresh:{container:"#pullrefresh",up:{contentrefresh:"正在加载...",contentnomore:"没有更多数据",callback:function(){o.this.pullupRefresh(o)}}}}),document.body.setAttribute("data-pageIndex",0),e.body.dataset.isscrolltotop=0,t.os.plus?t.plusReady(function(){setTimeout(function(){o.pullrefresh.pullRefresh().pullupLoading()},1e3)}):t.ready(function(){o.pullrefresh.pullRefresh().pullupLoading()})},_initGoodsTmpl:function(e){t(e.listContainer).on("tap",".mui-media-body",function(t){t.preventDefault(t),t.stopPropagation(t)})},_initScreen:function(o){for(var i=e.querySelectorAll(".mui-screen-item .mui-scroll-wrapper"),n=0;n<i.length;n++){i[n].style.maxHeight="300px"}t(".mui-scroll-wrapper:not(.mui-content,.mui-not-scroll)").scroll(),t(".mui-screen-title").on("tap",".mui-screen-title-item",function(o){if(2==this.dataset.index){this.classList.toggle("mui-active"),t(".mui-screen-item")[this.dataset.index].classList.toggle("mui-active");var i=t.os.android?document.body.clientHeight-1:document.body.clientHeight;return t(".mui-screen-item")[this.dataset.index].style.height=document.body.scrollHeight-i+"px",!1}if(this.dataset.index==e.body.dataset.screenindex)this.classList.toggle("mui-active"),t(".mui-screen-item")[this.dataset.index].classList.toggle("mui-active");else{e.body.dataset.screenindex=this.dataset.index,this.dataset.index&&t(".mui-screen-title-item,.mui-screen-item").each(function(){2!=this.dataset.index&&this.classList.remove("mui-active")})&&t(".mui-screen-item")[this.dataset.index].classList.add("mui-active"),this.classList.add("mui-active");var i=t.os.android?document.body.clientHeight-1:document.body.clientHeight;t(".mui-screen-item")[this.dataset.index].style.height=document.body.scrollHeight-i+"px"}}),t(".mui-screen-nav").on("tap",".mui-screen-item",function(){t(".mui-screen-item").each(function(){this.classList.remove("mui-active")});for(var o=e.querySelectorAll('.mui-screen-item input[type="number"]'),i=0;i<o.length;i++){o[i].blur()}}),t(".mui-table-view-radio").on("tap",".mui-table-view-cell",function(i){e.body.dataset.screenindex&&(t(".mui-screen-title-item")[e.body.dataset.screenindex].querySelector(".title").innerText=this.innerText.trim()),o.this.pullClearAndReload(o)}),void 0!=t(".mui-screen-search")[0]&&(t(".mui-screen-search")[0].addEventListener("tap",function(t){t.target!=this.querySelector("button")&&(t.preventDefault(t),t.stopPropagation(t))}),t(".mui-screen-search").on("tap","button",function(){console.log("执行")})),t(o.brandsContainer).off(),t(o.brandsContainer).on("tap","a",function(t){this.classList.toggle("mui-active"),t.preventDefault(t),t.stopPropagation(t)}),t(".brands-btns").off(),t(".brands-btns").on("tap",".brands-btn",function(t){if("reset"==this.dataset.type){for(var e=o.brandsContainer.querySelectorAll("li a"),i=0;i<e.length;i++)e[i].classList.remove("mui-active");t.preventDefault(t),t.stopPropagation(t)}else"confirm"==this.dataset.type&&o.this.pullClearAndReload(o)})},pullupRefresh:function(o){var i=document.body.getAttribute("data-pageIndex");i=parseInt(i)+1,document.body.setAttribute("data-pageIndex",i);var n="",a={page:i,limit:20},s=e.querySelector(".mui-screen-title-item.mui-active");if(0==s.dataset.index){l=document.querySelector("li.mui-selected[data-condition]").dataset.condition}else 1==s.dataset.index&&(l=e.querySelector(".mui-empty-item").dataset.condition);switch(""==l&&void 0==l||(a.sortType=l),o.targetType){case"2":n=o.getGoodsCatsListUrl;for(var r=o.brandsContainer.querySelectorAll("li a.mui-active"),u="",l="",d=0;d<r.length;d++)u+=r[d].dataset.brandid+",";r.length>0&&(u=u.substr(0,u.length-1),a.brandIdList=u);break;case"3":n=o.getGoodsByBrandUrl,a.brandId=o.targetId}var c={urlPath:n,data:a,onSuccess:function(i){if(1==i.head.bcode){var n=template("tmpl-model",i.data);o.listContainer.innerHTML+=n,0==i.data.items.length&&""==o.listContainer.innerHTML.trim()&&(o.listContainer.innerHTML=e.getElementById("tmpl-model-null").innerHTML),i.data.hasNextPage?o.pullrefresh.pullRefresh().endPullupToRefresh(!1):o.pullrefresh.pullRefresh().endPullupToRefresh(!0),t(o.listContainer).off("tap",".mui-media-btn"),t(o.listContainer).on("tap",".mui-media-btn",function(t){console.log("do something");var e=this.dataset.id;void 0!=e&&o.this.initPopoverCartItem(o,e),t.preventDefault(t),t.stopPropagation(t)}),t(o.listContainer).off("tap",".mui-media"),t(o.listContainer).on("tap",".mui-media",function(){var t=this.dataset.targettype,e=this.dataset.catid;switch(t){case"1":console.log("商品");var o=common.config.rootPath+"/phone/goods/view.html?catId="+e;setTimeout(function(){window.location.href=o},300)}})}else common.alert({msg:JSON.stringify(i.head.bmessage)||"读取出错"}),o.pullrefresh.pullRefresh().disablePullupToRefresh(),o.pullrefresh.pullRefresh().endPullupToRefresh(!0),""==o.listContainer.innerHTML.trim()&&(o.listContainer.innerHTML=e.getElementById("tmpl-model-null").innerHTML)},onError:function(){console.log("失败回调")}};AjaxCommon.getAjaxRequestJson(c)},pullClearAndReload:function(t){e.body.dataset.isscrolltotop=1,setTimeout(function(){document.getElementsByClassName("mui-model-null").length>0&&document.getElementsByClassName("mui-model-null")[0].parentNode.removeChild(document.getElementsByClassName("mui-model-null")[0]),t.pullrefresh.scroll().scrollTo(0,0),document.body.setAttribute("data-pageIndex",0),t.pullrefresh.pullRefresh().finished&&t.pullrefresh.pullRefresh().refresh(!0),t.listContainer.innerHTML="",t.pullrefresh.pullRefresh().pullupLoading()},500)},initPopoverCartItem:function(o,i){var n=document.getElementById(o.defaultCartPopover);null!=n&&n.parentNode.removeChild(n);var a=o.getGoodsDetailUrl+i+".json";alertOptions.msg="正在请求中...",alertOptions.callback=function(i){var n={urlPath:a,data:{},onSuccess:function(n){if(1==n.head.bcode){i.setMsg("请求成功！"),i.hide(),o.result=n;var a=template("tmpl-cart",n.data),s=e.querySelector(".mui-content");common.insertHTML(s,"afterend",a),t("#"+o.defaultCartPopover).popover("toggle"),e.querySelector(".mui-sku-close").addEventListener("tap",function(){t("#"+o.defaultCartPopover).popover("toggle")}),o.this.initPopoverCart(o),o.this.set$thisGroup(o),o.this.initSubmit(o)}else i.setMsg("请求失败！"),i.hide()},onError:function(){console.log("失败回调")}};AjaxCommon.getAjaxRequestJson(n)},common.alert(alertOptions)},checkData:function(t){var o=!0;if(t.result.data.attributes.length>0){var i=e.querySelectorAll("#popover-cart .mui-sku-attr button.mui-active");t.result.data.attributes.length!=i.length&&(common.alert({msg:"请选择规格"}),o=!1)}return 0==t.this.getThisBtn()[0].dataset.stock&&(common.alert({msg:"库存不足"}),o=!1),o},submitToOrder:function(t){for(var o={goodsItems:[],supplierItems:[]},i=e.querySelector(".mui-sku-attr .mui-button.mui-active"),n=i.dataset.itemid,a=0,s=0;s<t.result.data.goodsAttributes.length;s++)t.result.data.goodsAttributes[s].itemIds==n&&(a=t.result.data.goodsAttributes[s].goodsAttrId);var r=t.this.getThisBtn()[0],u=parseInt(r.querySelector("input").value),l={goodsAttributeId:a,goodsId:t.result.data.goodsId,quantity:u},d={isNeedLogistic:1,supplierId:t.result.data.supplier.supplierId};o.goodsItems.push(l),o.supplierItems.push(d);var c=t.subOrderUrl+"?orderStr="+window.encodeURIComponent(JSON.stringify(o));setTimeout(function(){window.location.href=c},300)},submitOrderOrCart:function(o){var i="",n={items:[]},a=null;i=o.addCartUrl;for(var s=e.querySelector(".mui-sku-attr .mui-button.mui-active"),r=s.dataset.itemid,u=0,l=0;l<o.result.data.goodsAttributes.length;l++)o.result.data.goodsAttributes[l].itemIds==r&&(u=o.result.data.goodsAttributes[l].goodsAttrId);var d=o.this.getThisBtn()[0],c=parseInt(d.querySelector("input").value),m={goodsAttributeId:u,quantity:c};n.items.push(m),a=function(e){t.toast("加入购物车成功!")};var p={urlPath:i,data:n,onSuccess:function(t){console.log(JSON.stringify(t)),1==t.head.bcode?a&&"function"==typeof a&&a(t):common.alert({msg:"提交出错"})},onError:function(){console.log("失败回调")},onComplete:function(){t("#"+o.defaultCartPopover).popover("toggle")}};AjaxCommon.getAjaxRequestJson(p)},initSubmit:function(e){t(".mui-sku-footer").on("tap",".mui-sku-btn",function(){switch(this.dataset.type){case"cart":var t=e.this.checkData(e);t&&e.this.submitOrderOrCart(e);break;case"order":var t=e.this.checkData(e);t&&e.this.submitToOrder(e);break;default:console.log("默认操作")}})},initPopoverCart:function(e){t("#popover-cart").on("tap",".mui-button",function(){for(var t=this,o=this.parentNode,i=o.querySelectorAll(".mui-button"),n=0;n<i.length;n++)t!=i[n]&&i[n].classList.remove("mui-active");if(this.classList.toggle("mui-active"),this.classList.contains("mui-active"))for(var a=this.dataset.itemid,s=this.innerHTML.trim(),n=0;n<e.result.data.goodsAttributes.length;n++)e.result.data.goodsAttributes[n].itemIds==a&&e.this.setSkuCartStatus(e,e.result.data.goodsAttributes[n],s);else{var r={retailPrice:e.result.data.retailPrice,stock:e.this.setCountStock(e)},u="请选择 "+o.querySelector(".mui-sku-attrname").innerHTML;e.this.setSkuCartStatus(e,r,u)}})},setSkuCartStatus:function(t,e,o){var i=t.this.getSkuOpts();i.skuPrice.innerHTML=e.retailPrice,i.skuStock.innerHTML=e.stock;for(var n in i.skuAttrs)i.skuAttrs[n].innerHTML=o;for(var n=0;n<t.this.getThisBtn().length;n++){var a=t.this.getThisBtn()[n];a.dataset.price=e.retailPrice,a.dataset.stock=e.stock,a.dataset.goodsattrid=e.goodsAttrId,e.stock<a.dataset.qty&&(a.dataset.qty=e.stock)}t.this.set$thisGroup(t)},setCountStock:function(t){for(var e=0,o=t.result.data.goodsAttributes,i=0;i<o.length;i++)e+=o[i].stock;return e},getSkuOpts:function(){return{skuImg:e.querySelector("#popover-cart .mui-sku-object"),skuPrice:e.querySelector("#popover-cart .sku-price"),skuStock:e.querySelector("#popover-cart .sku-stock"),skuAttrs:e.querySelectorAll(".sku-attrStr"),skuAttrId:0,skuGoodsId:0}},getThisBtn:function(){return e.querySelectorAll("._self-group")},set$thisGroup:function(e){for(var o=e.this.getThisBtn(),i=0;i<o.length;i++)t(o[i]).plusMinusBtn({max:o[i].getAttribute("data-stock"),buyQty:parseInt(o[i].getAttribute("data-stock"))>parseInt(o[i].getAttribute("data-qty"))?parseInt(o[i].getAttribute("data-qty")):0,quantity:o[i].getAttribute("data-quantity"),btnClass:"input-group-btn mui-btn",btnCssText:"",buyNumberCssText:"",buyNumberClass:"mui-input-group",stockClass:"shop-stock mui-color-000",isShowStock:!1,min:1,onPlus:function(t){t.btnGroup.setAttribute("data-qty",t.getBuyNum())},onMinus:function(t){t.btnGroup.setAttribute("data-qty",t.getBuyNum())},onChange:function(t){t.btnGroup.setAttribute("data-qty",t.getBuyNum())}},!0)}};window.screenNav=o}(mui,document);