;+(function(mui,doc,undefined){"use strict";var model={init:function(options){options=this.setOptions(options||{});mui.init();this.initGetTagsUrl(options);},setOptions:function(options){options.this=this;options.scale=0.56;options.getOrderListUrl=common.config.appPath+'/api/order/list';options.bodyContainer=doc.getElementById('pull-body');options.tmplHtmlModelEmpty=doc.getElementById('tmpl-model-null');options.addCartUrl=common.config.rootPath+'/api/cart/add';options.unpaidCancelUrl=common.config.appPath+'/api/order/cancel';options.confirmUrl=common.config.appPath+'/api/order/confirm';options.deleteUrl=common.config.appPath+'/api/order/delete.json';options.payOrderUrl=common.config.rootPath+'/pay/index.html';options.toFindStoreUrl=common.config.rootPath+'/order/findstore.html';options.detailOrderUrl=common.config.rootPath+'/order/view.html';options.reviewOrderUrl=common.config.rootPath+'/order/review.html';return options},initGetTagsUrl:function(options){var menuHtml=template('tmpl-menus',options.navResult);options.bodyContainer.innerHTML=menuHtml;var listContainers=options.bodyContainer.querySelectorAll('.list-container');for(var int=0;int<listContainers.length;int+=1){var array_element=listContainers[int];array_element.style.minHeight=(window.screen.height-84-52-40)+"px"}var deceleration=mui.os.ios?0.003:0.0009;mui('.mui-scroll-wrapper').scroll({bounce:false,indicators:false,deceleration:deceleration});mui('.mui-slider').slider();options.controls=document.getElementById("segmentedControls");options.contents=document.getElementById("segmentedControlContents");options.this.initLeftListEvents(options);mui.each(options.this.getScrollContainers(),function(index,pullRefreshEl){mui(pullRefreshEl).pullToRefresh({up:{callback:function(){var self=this;options.this.pullUpLoadGoodsGroup(options,self)}}})});if(mui.os.plus){mui.plusReady(function(){setTimeout(function(){options.this.pullUpLoading(options)},1000)})}else{mui.ready(function(){options.this.pullUpLoading(options)})}AjaxCommon.pageInit('.list-container')},initLeftListEvents:function(options){document.querySelector('.mui-slider').addEventListener('slide',function(event){setTimeout(function(){options.this.pullUpLoading(options)},500)})},pullUpLoading:function(options){var ProductContainer=options.this.getActiveProductContainer();var scrollContainers=options.this.getScrollContainers();var activeContainer=ProductContainer.querySelector('.list-container');if(activeContainer.innerHTML.trim()===''){var _thisIndex=activeContainer.dataset.index;mui(scrollContainers[_thisIndex]).pullToRefresh().pullUpLoading()}},getActiveProductContainer:function(){return doc.querySelector('.mui-control-content.mui-active')},getScrollContainers:function(){return mui(document.querySelectorAll('.mui-slider-group .mui-scroll'))},pullUpLoadGoodsGroup:function(options,_selfPullRefresh){var activeContainer=options.this.getActiveProductContainer();if(activeContainer==null){common.alert({msg:'获取当前模块出错'});return false}var listContainer=activeContainer.querySelector('.list-container');var pageIndex=listContainer.getAttribute('data-pageIndex');pageIndex=parseInt(pageIndex)+1;listContainer.setAttribute('data-pageIndex',pageIndex);var data={"status":listContainer.dataset.id,"limit":10,"type":0,"page":pageIndex,"keyword":''};var optObjs={urlPath:options.getOrderListUrl,data:data,onSuccess:function(result){if(result.status==0){if(result.data.content.length>0){var html=template('tmpl-model',result.data);listContainer.innerHTML+=html;options.this.inspectTrim(listContainer);if(pageIndex==1){options.controls.querySelectorAll('.mui-control-item')[listContainer.dataset.index].innerText+='('+result.data.totalElements+')'}options.this.initEvent(options)}else{if(listContainer.innerHTML.trim()==''){listContainer.innerHTML=options.tmplHtmlModelEmpty.innerHTML}}if(result.data.hasNextPage){_selfPullRefresh.endPullUpToRefresh(false)}else{_selfPullRefresh.endPullUpToRefresh(true);var bottomTips=activeContainer.querySelector('.mui-pull-bottom-tips');if(bottomTips!=null&&!bottomTips.classList.contains('mui-hide')){bottomTips.classList.add('mui-hide')}}if(activeContainer.querySelector('.spinner-child')!=null&&!activeContainer.querySelector('.spinner-child').classList.contains('mui-hide')){activeContainer.querySelector('.spinner-child').classList.add('mui-hide')}}else{common.alert({msg:result.msg||'读取出错'})}},onError:function(){console.log('失败回调');if(activeContainer.querySelector('.spinner-child')!=null&&!activeContainer.querySelector('.spinner-child').classList.contains('mui-hide')){activeContainer.querySelector('.spinner-child').classList.add('mui-hide')}if(listContainer.innerHTML.trim()==''){listContainer.innerHTML=options.tmplHtmlModelEmpty.innerHTML}}};AjaxCommon.getAjaxRequestJson(optObjs)},pullUpToRefreshScrollToTop:function(options){var activeContainer=options.this.getActiveProductContainer();mui(activeContainer.querySelector('.mui-scroll-wrapper')).pullRefresh().scrollTo(0,0,1500);},inspectTrim:function(listContainer){var muiControls=listContainer.querySelectorAll('.mui-control a');mui(muiControls).each(function(index,ele){if(muiControls[index].innerHTML.trim()==''&&!muiControls[index].parentElement.classList.contains('mui-hide')){muiControls[index].parentElement.classList.add('mui-hide')}})},initEvent:function(options){mui('.list-container').off('tap');AjaxCommon.pageInit('.list-container');mui('.list-container').on('tap','span',function(){var $this=this;var type=$this.dataset.type;switch(type){case "wxpay":options.this.pay(options,$this);break;case "confirm":options.this.confirm(options,$this);break;case "review":options.this.review(options,$this);break;case "close":options.this.cancelOrder(options,$this);break;default:break}})},pay:function(options,$this){setTimeout(function(){var orderNumber=$this.getAttribute('data-ordernumber');var data={orderNumber:orderNumber};window.location.href=options.payOrderUrl+'?orderNumber='+orderNumber;},500)},confirm:function(options,$this){var orderNumber=$this.getAttribute('data-ordernumber');alertOptions.msg='确认收货中...';alertOptions.callback=function(alertContext){var optObjs={urlPath:options.confirmUrl,data:{"orderNumber":orderNumber},onSuccess:function(result){if(result.status==0){var ulClassName='.order-ul-'+orderNumber;var activeContainer=options.this.getActiveProductContainer();var $ul=activeContainer.querySelector(ulClassName);$ul.parentNode.removeChild($ul);alertContext.setMsg('确认收货成功！');alertContext.hide()}else{alertContext.setMsg('确认收货失败！');alertContext.hide()}},onError:function(){console.log('失败回调')}};AjaxCommon.getAjaxRequestJson(optObjs)};common.alert(alertOptions)},deleteOrder:function(options,$this){var orderNumber=$this.getAttribute('data-ordernumber');alertOptions.msg='正在删除中...';alertOptions.callback=function(alertContext){var optObjs={urlPath:options.deleteUrl,data:{"orderNumber":orderNumber},onSuccess:function(result){if(result.status==0){var ulClassName='.order-ul-'+orderNumber;var activeContainer=options.this.getActiveProductContainer();var $ul=activeContainer.querySelector(ulClassName);$ul.parentNode.removeChild($ul);alertContext.setMsg('删除成功...');alertContext.hide()}else{alertContext.setMsg('删除失败');alertContext.hide()}},onError:function(){console.log('失败回调')}};AjaxCommon.getAjaxRequestJson(optObjs)};common.alert(alertOptions)},cancelOrder:function(options,$this){var ordernumber=$this.getAttribute('data-ordernumber');alertOptions.msg='正在取消中...';alertOptions.callback=function(alertContext){var optObjs={urlPath:options.unpaidCancelUrl,data:{"orderNumber":ordernumber},onSuccess:function(result){if(result.status==0){alertContext.setMsg('取消成功...');alertContext.hide();$this.parentNode.parentNode.parentNode.classList.add('mui-hide');var title=options.controls.querySelector('.mui-control-item.mui-active');var itemNumber=title.innerText.match(/[1-9][0-9]*/g)[0];if(!isNaN(parseInt(itemNumber))){var ints=parseInt(itemNumber)-1;title.innerText=title.innerText.replace(itemNumber,ints)}}else{alertContext.setMsg('取消失败');alertContext.hide()}},onError:function(){console.log('失败回调')}};AjaxCommon.getAjaxRequestJson(optObjs)};common.alert(alertOptions)},review:function(options,$this){setTimeout(function(){var orderNumber=$this.getAttribute('data-ordernumber');window.location.href=options.reviewOrderUrl+"?orderNumber="+orderNumber},350)}};window.orderIndex=model}(mui,document,undefined));