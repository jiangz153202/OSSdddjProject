+function(e,t,n){"use strict";var i={init:function(t){t=this.setOptions(t||{}),e.init(),this.initGetTagsUrl(t)},setOptions:function(e){return e.this=this,e.scale=.56,e.getModelListUrl=common.config.appPath+"/api/coupon/listCoupon",e.bodyContainer=t.getElementById("pull-body"),e.tmplHtmlModelEmpty=t.getElementById("tmpl-model-null"),e.exchangeUrl=common.config.appPath+"/api/coupon/exchange",e},initGetTagsUrl:function(n){var i=template("tmpl-menus",n.navResult);n.bodyContainer.innerHTML=i;var o=e.os.ios?.003:9e-4;e(".mui-scroll-wrapper").scroll({bounce:!1,indicators:!1,deceleration:o}),e(".mui-slider").slider(),n.this.initLeftListEvents(n),e.each(n.this.getScrollContainers(),function(t,i){e(i).pullToRefresh({up:{callback:function(){var e=this;n.this.pullUpLoadGoodsGroup(n,e)}}})}),e.os.plus?e.plusReady(function(){setTimeout(function(){n.this.pullUpLoading(n)},1e3)}):e.ready(function(){n.this.pullUpLoading(n)}),_wxShareApi.wechatConfig(n,function(){var e=document.getElementById("qrScan");null!=e&&e.addEventListener("tap",function(){wx.scanQRCode({needResult:0,scanType:["qrCode","barCode"],success:function(e){e.resultStr}})})});var l=t.getElementById("exchange-coupon"),r=t.getElementById("exchange-btn");null!=l&&(l.addEventListener("keyup",function(e){l.value.length>=2?(r.classList.remove("mui-btn-grey"),r.classList.remove("mui-disabled"),r.classList.add("mui-btn-default")):(r.classList.remove("mui-btn-default"),r.classList.add("mui-btn-grey"),r.classList.add("mui-disabled"))}),null!=r&&r.addEventListener("tap",function(){n.this.exchangeCoupon(n,l.value.trim())}))},initLeftListEvents:function(e){document.querySelector(".mui-slider").addEventListener("slide",function(t){setTimeout(function(){e.this.pullUpLoading(e)},500)})},pullUpLoading:function(t){var n=t.this.getActiveProductContainer(),i=t.this.getScrollContainers(),o=n.querySelector(".list-container");if(""===o.innerHTML.trim()){e(i[o.dataset.index]).pullToRefresh().pullUpLoading()}},getActiveProductContainer:function(){return t.querySelector(".mui-control-content.mui-active")},getScrollContainers:function(){return e(document.querySelectorAll(".mui-slider-group .mui-scroll"))},pullUpLoadGoodsGroup:function(e,n){var i=e.this.getActiveProductContainer();if(null==i)return common.alert({msg:"获取当前模块出错"}),!1;var o=i.querySelector(".list-container"),l=o.getAttribute("data-pageIndex");l=parseInt(l)+1,o.setAttribute("data-pageIndex",l);var r={status:o.dataset.id,pageIndex:l},s={urlPath:e.getModelListUrl,data:r,onSuccess:function(r){if(0==r.status){if(r.data.content.length>0){var s=template("tmpl-model",r.data);o.innerHTML+=s,e.this.inspectTrim(o),1==l&&(t.querySelector(".mui-control-item.mui-active").innerText+="("+r.data.totalElements+")")}else""==o.innerHTML.trim()&&(o.innerHTML=e.tmplHtmlModelEmpty.innerHTML);r.data.hasNextPage?n.endPullUpToRefresh(!1):n.endPullUpToRefresh(!0),null==i.querySelector(".spinner-child")||i.querySelector(".spinner-child").classList.contains("mui-hide")||i.querySelector(".spinner-child").classList.add("mui-hide")}else common.alert({msg:r.msg||"读取出错"})},onError:function(){console.log("失败回调"),null==i.querySelector(".spinner-child")||i.querySelector(".spinner-child").classList.contains("mui-hide")||i.querySelector(".spinner-child").classList.add("mui-hide"),""==o.innerHTML.trim()&&(o.innerHTML=e.tmplHtmlModelEmpty.innerHTML)}};AjaxCommon.getAjaxRequestJson(s)},pullUpToRefreshScrollToTop:function(t){e(t.this.getActiveProductContainer().querySelector(".mui-scroll-wrapper")).pullRefresh().scrollTo(0,0,1500)},inspectTrim:function(t){var n=t.querySelectorAll(".mui-control a");e(n).each(function(e,t){""!=n[e].innerHTML.trim()||n[e].parentElement.classList.contains("mui-hide")||n[e].parentElement.classList.add("mui-hide")})},exchangeCoupon:function(e,t){var n=!0;alertOptions.msg="正在请求中...",alertOptions.callback=function(i){var o={urlPath:e.exchangeUrl,data:{exchangeCode:t},onSuccess:function(e){0==e.status?(i.setMsg("兑换成功!"),i.hide(),window.location.reload()):(i.setMsg("兑换失败,请重试!"),i.hide())},onError:function(){console.log("失败回调"),i.setMsg("兑换出错,请稍后重试!"),i.hide()},onComplete:function(){n=!0}};AjaxCommon.getAjaxRequestJson(o)},n&&(n=!1,common.alert(alertOptions))}};window.coupon=i}(mui,document);