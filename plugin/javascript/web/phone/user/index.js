+function(e,t){var a={init:function(e){e=this.setOptions(e||{}),this.initPage(e)},setOptions:function(a){return a.this=this,a.pullrefresh=e("#pullrefresh"),a.listContainer=t.getElementById("list-container"),a.getListOrderStatusUrl=common.config.appPath+"/api/order/userStatusCount",a.getCheckIsStoreUrl=common.config.appPath+"/api/user/isStore",a.getCheckIsDeliveryStoreUrl=common.config.appPath+"/api/user/isStoreServer",a.userDomItem={avatar:document.getElementById("avatar"),userName:document.getElementById("userName"),userNo:document.getElementById("userNo")},a},initPage:function(a){var o={orderItem:{tagId:0,tagName:"全部订单",tagCount:0,isLogined:!1,tagUrl:"/p/order/index",childItem:[{tagId:2,tagName:"待付款",tagCount:0,tagIcon:"icon-daifukuan",isLogined:!1},{tagId:1,tagName:"待接单",tagCount:0,tagIcon:"icon-daipingjia",isLogined:!1},{tagId:3,tagName:"待配送",tagCount:0,tagIcon:"icon-daipeisong",isLogined:!1},{tagId:9,tagName:"待确认",tagCount:0,tagIcon:"icon-liaotian",isLogined:!1},{tagId:5,tagName:"待评价",tagCount:0,tagIcon:"icon-daipingjia",isLogined:!1}]},toolModule:{tagName:"我的工具",childItem:[{tagName:"商品订单",tagIcon:"/framwork/_global_icon/mipmap-xhdpi/ic_me01.png",tagHref:"/p/order/index",isSliderCell:!1,sliderCellIcon:""},{tagName:"门店预约",tagIcon:"/framwork/_global_icon/mipmap-xhdpi/ic_me02.png",tagHref:'javascript:alert("暂未开放");',isSliderCell:!1,sliderCellIcon:""},{tagName:"收货地址",tagIcon:"/framwork/_global_icon/mipmap-xhdpi/ic_me16.png",tagHref:"/p/user/address",isSliderCell:!1,sliderCellIcon:""},{tagName:"优惠劵",tagIcon:"/framwork/_global_icon/mipmap-xhdpi/ic_me05.png",tagHref:"/p/user/coupon",isSliderCell:!1,sliderCellIcon:""},{tagName:"邀请好友",tagIcon:"/framwork/_global_icon/mipmap-xhdpi/ic_me07.png",tagHref:'javascript:alert("暂未开放");',isSliderCell:!0,sliderCellIcon:"/framwork/_global_icon/mipmap-xhdpi/ic_jiaobiao.png"},{tagName:"联系客服",tagIcon:"/framwork/_global_icon/mipmap-xhdpi/ic_me11.png",tagHref:"/p/user/service",isSliderCell:!1,sliderCellIcon:""},{tagName:"帮助反馈",tagIcon:"/framwork/_global_icon/mipmap-xhdpi/ic_me12.png",tagHref:"/p/user/problem",isSliderCell:!1,sliderCellIcon:""}]}},n=template("tmpl-model",o);a.listContainer.innerHTML=n;var r=e.os.ios?.003:9e-4;e(".mui-scroll-wrapper").scroll({bounce:!1,indicators:!1,deceleration:r}),AjaxCommon.isLogined(function(){console.log("已登录"),a.userItem=AjaxCommon.getLoginUser(),a.this.setAttribute(a),a.this.setOrderStatus(a);var e=t.getElementById("store-container");if(a.userItem.roleNumbers.length>0)for(var o=0;o<a.userItem.roleNumbers.length;o++){var n=a.userItem.roleNumbers[o];200==n&&e.classList.remove("mui-hide")}},function(){console.log("没有登录"),AjaxCommon.switchTarget.unLogined()})},checkIsStore:function(e){var a={urlPath:e.getCheckIsStoreUrl,data:{},onSuccess:function(e){if(e){t.getElementById("store-container").classList.remove("mui-hide")}},onError:function(){console.log("我的订单加载失败!")}};AjaxCommon.getAjaxRequestJson(a)},setOrderStatus:function(e){var a={urlPath:e.getListOrderStatusUrl,data:{},onSuccess:function(e){if(0==e.status&&e.data.length>0)for(var a=t.querySelectorAll(".order-bar li.js-all-goods"),o=0;o<a.length;o++)for(var n=a[o].querySelector(".mui-badge"),r=0;r<e.data.length;r++){var s=e.data[r];n.dataset.status==s.status&&s.count>0&&(n.innerHTML=s.count,n.classList.remove("mui-hide"))}},onError:function(){console.log("我的订单加载失败!")}};AjaxCommon.getAjaxRequestJson(a)},setAttribute:function(e){var t=e.userItem;null!=t&&(null!=t.headImgUrl&&(e.userDomItem.avatar.src=t.headImgUrl),e.userDomItem.userName.innerHTML=null==t.nickname?t.username:t.nickname,null!=t.memberNumber&&(e.userDomItem.userNo.innerHTML=t.memberNumber))},installed:function(){var e=AjaxCommon.carUserInfo;null!=e?(document.getElementById("avatar").src=e.avatar,document.getElementById("userName").innerText=e.userName,document.getElementById("upUserName").addEventListener("tap",function(){1!=e.userNameIsModified?setTimeout(function(){window.location.href=common.config.rootPath+"/user/userName"},300):common.alert({msg:"用户名只能修改一次"})}),document.getElementById("userPassword").addEventListener("tap",function(){1==e.isLoginPassSet?setTimeout(function(){window.location.href=common.config.rootPath+"/user/modifyWord"},300):setTimeout(function(){window.location.href=common.config.rootPath+"/user/password"},300)})):setTimeout(function(){window.location.href=common.config.homeUrl},300)},message:function(e){var t={urlPath:e.messageUrl,data:e.data,onSuccess:function(t){if(1==t.head.bcode){e.data=t.data;for(var o in e.data)void 0!=e.data[o]._newestMessage.msgCatId&&(e.data[o]._newestMessage.createTime=a.getTimes(e.data[o]._newestMessage.createTime,0));var n=template("tmpl-messages",e.data);e.bodyContainer.innerHTML=n}else common.alert({msg:t.head.bmessage||"信息读取失败"})},onError:function(){console.log("失败回调")}};AjaxCommon.getAjaxRequestJson(t)},messageInitPage:function(o){var n=e.os.ios?.003:9e-4;e(".mui-scroll-wrapper").scroll({bounce:!1,indicators:!1,deceleration:n}),e.init({pullRefresh:{container:"#pullrefresh",up:{contentrefresh:"正在加载...",contentnomore:"没有更多数据",callback:function(){a.messageItem(o)}}}}),document.body.setAttribute("data-pageIndex",0),t.body.dataset.isscrolltotop=0,e.os.plus?e.plusReady(function(){setTimeout(function(){o.pullrefresh.pullRefresh().pullupLoading()},1e3)}):e.ready(function(){o.pullrefresh.pullRefresh().pullupLoading()})},messageItem:function(e){var t=document.body.getAttribute("data-pageIndex");t=parseInt(t)+1,e.data.page=t,document.body.setAttribute("data-pageIndex",t);var o={urlPath:e.messageUrl,data:e.data,onSuccess:function(t){if(0==t.status){var o=t.data,n=null!=o.items?o.items.length:0;for(var r in o.items){var s=o.items[r];0!=s.targetType&&(s.typeUrl=a.targetType(s.targetType,s.targetId)),s.createTime=a.getTimes(s.createTime,1)}o.pageTime=n>0?o.items[n-1].createTime:"";var i=template("tmpl-message",o);e.bodyContainer.innerHTML+=i,t.data.hasNextPage?e.pullrefresh.pullRefresh().endPullupToRefresh(!1):e.pullrefresh.pullRefresh().endPullupToRefresh(!0)}else common.alert({msg:t.msg||"信息读取失败"}),e.pullrefresh.pullRefresh().disablePullupToRefresh(),e.pullrefresh.pullRefresh().endPullupToRefresh(!0)},onError:function(){console.log("失败回调")}};AjaxCommon.getAjaxRequestJson(o)},telephone:function(){var t=document.getElementById("list-container").getElementsByTagName("input"),o=document.getElementById("code"),n=document.getElementById("submit");a.active(t,n,o),a.telephoneCode(o,t[0],60),document.getElementById("submit").addEventListener("tap",function(){}),e("#list-container").on("tap",".mui-icon-clear",function(){"tel"==this.previousSibling.name&&o.classList.remove("default-but-active")})},password:function(e){e=this.setOptions(e||{});var t=/[\u4E00-\u9FA5]/,o=document.getElementById("password"),n=document.getElementById("submit");o.addEventListener("keyup",function(){""!=this.value.trim()?n.classList.remove("opacity7"):n.classList.add("opacity7")}),n.addEventListener("tap",function(){t.test(o.value.trim())?common.alert({msg:"不能输入中文"}):common.GetLength(o.value.trim())<6?common.alert({msg:"密码长度过短"}):common.GetLength(o.value.trim())>20?common.alert({msg:"密码超出限定长度"}):(common.loading(),e.addPasswordUrl=common.config.carAppPath+"/capi/user/save/password.json",e.data={newPassword:o.value.trim()},a.savePassword(e))}),a.upType()},modifyWord:function(e){e=this.setOptions(e||{});var t=/[\u4E00-\u9FA5]/,o=document.getElementById("list-container").getElementsByTagName("input"),n=document.getElementById("submit");a.active(o,n,null),n.addEventListener("tap",function(){return""==o[0].value.trim()?void o[0].focus():""==o[1].value.trim()?void o[1].focus():void(t.test(o[1].value.trim())?common.alert({msg:"不能输入中文"}):common.GetLength(o[1].value.trim())<6?common.alert({msg:"新密码长度过短"}):common.GetLength(o[1].value.trim())>20?common.alert({msg:"新密码超出限定长度"}):(common.loading(),e.upPasswordUrl=common.config.carAppPath+"/capi/user/update/password.json",e.data={oldPassword:o[0].value.trim(),newPassword:o[1].value.trim()},a.upPassword(e)))}),a.upType()},userName:function(e){e=this.setOptions(e||{});var t=/^[a-zA-Z\u4e00-\u9fa5]+$/,o=AjaxCommon.carUserInfo,n=document.getElementById("userName");null!=o?n.value=o.userName:o={userName:""},document.getElementById("submit").addEventListener("tap",function(){""!=n.value.trim()&&(n.value.trim()==o.userName?window.history.back():t.test(n.value.trim())?common.GetLength(n.value.trim())<4?common.alert({msg:"字符长度过短"}):common.GetLength(n.value.trim())<=12?(common.loading(),e.upUserNameUrl=common.config.carAppPath+"/capi/user/update/username.json",e.validateUserNameUrl=common.config.carAppPath+"/capi/user/validate/username.json",e.data={userName:n.value.trim()},a.validateUserName(e)):common.alert({msg:"超出字符限定长度"}):common.alert({msg:"包含特殊字符"}))})},upType:function(){e(".mui-input-row").on("tap",".us-word",function(e){e.target.className.indexOf("us-word-display")>0?(e.target.parentNode.getElementsByTagName("input")[0].type="password",e.target.classList.remove("us-word-display")):(e.target.parentNode.getElementsByTagName("input")[0].type="text",e.target.classList.add("us-word-display"))})},upUserName:function(e){var t={urlPath:e.upUserNameUrl,data:e.data,onSuccess:function(t){1==t.head.bcode?(AjaxCommon.carUserInfo.userName=e.data.userName,AjaxCommon.carUserItem.userInfo.userName=e.data.userName,window.localStorage.setItem("carUserItem",JSON.stringify(AjaxCommon.carUserItem)),window.localStorage.setItem("carUserInfo",JSON.stringify(t.carUserInfo)),window.history.back()):(common.removeLoader(),common.alert({msg:t.head.bmessage||"修改失败"}),setTimeout(function(){common.removeBlockUI()},1500))},onError:function(){console.log("失败回调")}};AjaxCommon.getAjaxRequestJson(t)},validateUserName:function(e){var t={urlPath:e.validateUserNameUrl,data:e.data,onSuccess:function(t){1==t.head.bcode?a.upUserName(e):(common.removeLoader(),common.alert({msg:t.head.bmessage||"名称已存在"}),setTimeout(function(){common.removeBlockUI()},1500))},onError:function(){console.log("失败回调")}};AjaxCommon.getAjaxRequestJson(t)},savePassword:function(e){var t={urlPath:e.addPasswordUrl,data:e.data,onSuccess:function(e){1==e.head.bcode?window.history.back():(common.removeLoader(),common.alert({msg:e.head.bmessage||"密码保存失败"}),setTimeout(function(){common.removeBlockUI()},1500))},onError:function(){console.log("失败回调")}};AjaxCommon.getAjaxRequestJson(t)},upPassword:function(e){var t={urlPath:e.upPasswordUrl,data:e.data,onSuccess:function(e){1==e.head.bcode?window.history.back():(common.removeLoader(),common.alert({msg:e.head.bmessage||"密码修改失败"}),setTimeout(function(){common.removeBlockUI()},1500))},onError:function(){console.log("失败回调")}};AjaxCommon.getAjaxRequestJson(t)},telephoneCode:function(e,t,a){e.addEventListener("tap",function(){if(this.className.indexOf("default-but-active")>0){this.classList.remove("default-but-active");var o=setInterval(function(){a--,e.innerText=a+"秒",1==a&&(a=60,e.classList.add("default-but-active"),e.innerText="获取验证码",clearInterval(o))},1e3),n={urlPath:common.config.carAppPath+"/capi/sms/validate/sendOnRegist/"+t.value+".json",data:{request_key:(new Date).getTime().toString()},onSuccess:function(e){1!=e.head.bcode&&common.alert({msg:e.head.bmessage||"号码已注册"})},onError:function(){console.log("账号已存在")}};AjaxCommon.getAjaxRequestJson(n)}})},active:function(e,t,a){for(var o=!0,n=0;n<e.length;n++)e[n].addEventListener("keyup",function(){if("tel"==this.name)/^1[34578]\d{9}$/.test(this.value)?a.classList.add("default-but-active"):a.classList.remove("default-but-active");else{for(var n=0;n<e.length;n++)if(""==e[n].value)return o=!1,t.classList.add("opacity7"),!1;o&&t.classList.remove("opacity7"),o=!0}})},getTimes:function(e,t){var a=new Date,o=Date.parse(a.toLocaleDateString())-864e5,n=new Date(e),r=0==t?"/":"-",s=n.toLocaleDateString().replace(/\//g,r)+" "+n.toTimeString().substr(0,5);return s=n.toDateString()===a.toDateString()?0==t?s.split(" ")[1]:"今天":o==Date.parse(n.toLocaleDateString())?"昨天":s.split(" ")[0]},targetType:function(e,t){var a="",o=common.config.rootPath;switch(e){case 1:a="/goods/view?catId="+t;break;case 2:a="/goods/classification?targetType=2&targetId="+t;break;case 3:a="/goods/classification?targetType=3&targetId="+t;break;default:o="",a="javascript:;"}return o+a}};window.carUser=a}(mui,document);