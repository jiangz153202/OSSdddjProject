+function(o,n){var e={init:function(o){o=this.setOptions(o||{}),this.initPage(o)},setOptions:function(e){return e.this=this,e.listContainer=n.getElementById("list-container"),e.couponsContainer=n.getElementById("coupons-container"),e.getModelUrl=common.config.appPath+"/api/coupon/queryObtained",e.setObtainUrl=common.config.appPath+"/api/coupon/obtain",e.setExchangeUrl=common.config.appPath+"/api/coupon/exchange",e.pullrefresh=o("#pullrefresh"),e.couponsId=void 0==common.queryToJSON().couponsId?"":common.queryToJSON().couponsId,e.exchangeCode=void 0==common.queryToJSON().exchangeCode?"":common.queryToJSON().exchangeCode,e.source=void 0==common.queryToJSON().source?"":common.queryToJSON().source,e.callback=void 0==common.queryToJSON().callback?"":common.queryToJSON().callback,e},initPage:function(o){o.this.initModel(o)},initModel:function(e){var t={urlPath:e.getModelUrl,data:{couponsId:e.couponsId,exchangeCode:e.exchangeCode,source:e.source},onBeforeSend:function(){},onSuccess:function(t){if(0==t.status&&null!=t.data){var i=template("tmpl-model",t.data);if(e.listContainer.innerHTML+=i,t.data.obtainedList.length>0){var i=template("tmpl-coupon",t.data.obtainedList);e.couponsContainer.innerHTML+=i}o(".mui-slider").slider({interval:3e3});var a=o.os.ios?.003:9e-4;if(o(".mui-scroll-wrapper").scroll({bounce:!1,indicators:!1,deceleration:a}),o(".mui-card").on("tap","button",function(){"立即使用"==this.innerText.trim()&&(window.location.href=common.config.homeUrl)}),0==t.data.obtainedList.length){var c=n.getElementById("pay-submit");null!=c&&c.addEventListener("tap",function(){e.this.exchangeCoupon(e)})}}else""==e.listContainer.innerHTML.trim()&&(e.listContainer.innerHTML=document.getElementById("tmpl-model-null").innerHTML,e.couponsContainer.parentNode.classList.add("mui-hide"))},onError:function(){console.log("失败回调"),""==e.listContainer.innerHTML.trim()&&(e.listContainer.innerHTML=document.getElementById("tmpl-model-null").innerHTML,e.couponsContainer.parentNode.classList.add("mui-hide"))}};AjaxCommon.getAjaxRequestJson(t)},exchangeCoupon:function(o){var n=!0,e=""==o.exchangeCode?o.setObtainUrl:o.setExchangeUrl;alertOptions.msg="正在请求中...",alertOptions.callback=function(t){var i={urlPath:e,data:{couponsId:o.couponsId,exchangeCode:o.exchangeCode,source:o.source},onSuccess:function(n){0==n.status?(t.setMsg("领取成功!"),t.hide(),""!=o.callback?window.location.href=o.callback:window.location.reload()):(t.setMsg("领取失败,请重试!"),t.hide())},onError:function(){console.log("失败回调"),t.setMsg("领取失败,请重试!"),t.hide()},onComplete:function(){n=!0}};AjaxCommon.getAjaxRequestJson(i)},n&&(n=!1,common.alert(alertOptions))}};window.obtain=e}(mui,document);